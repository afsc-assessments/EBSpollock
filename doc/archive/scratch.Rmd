---
title: "Exploration of some survey scenarios"
date: "`r format(Sys.time(), '%H:%M %B %d, %Y')`"
output:
  html_document:
    df_print: paged
  pdf_document:
    toc: true
    highlight: zenburn
    fig_caption: yes
    includes:
    keep_tex: yes
fontsize: 11pt
header-includes:
geometry: margin=1in
fontfamily: mathpazo
---
\pagenumbering{gobble}

```{r global_options, include=FALSE}

library(knitr)
opts_chunk$set(fig.width = 6, fig.height = 8, echo = FALSE, warning = FALSE, message = FALSE, cache=FALSE,results="asis")
clean_cache(clean = TRUE)
#include = FALSE prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.
#echo = FALSE prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.
#message = FALSE prevents messages that are generated by code from appearing in the finished file.
#warning = FALSE prevents warnings that are generated by code from appearing in the finished.
#fig.cap = "..." adds a caption to graphical results.
#To set global options that apply to every chunk in your file, call knitr::opts_chunk$set in a code chunk. Knitr will treat each option that you pass to 
```
----


```{r giddy}
# settings for speed/updating 
setwd("~/_mymods/ebswp/doc")
source("../pm_20.R")
```

```{r input_n,results="asis",echo=FALSE}

  p1 <- plot_avo(modlst[c(1,4,5)])
  p1
df <- NULL
mod_scen <-c(4,5) 
for (ii in mod_scen) {
    x       <- modlst[[ii]]
    ssb    <- x$nextyrssbs;         names(ssb)            <- paste0("${B}_{", nextyr ,"}$")
    ssbcv  <- round(x$nextyrssb.cv,2);  names(ssbcv)      <- paste0("$CV_{B_{", nextyr ,"}}$")
    Bmsy   <- x$bmsys;         names(Bmsy)                <- "$B_{MSY}$"
    Bmsycv <- round(x$bmsy.cv,2); names(Bmsycv)           <- "$CV_{B_{MSY}}$"
    spr    <- paste0(round(x$sprmsy*100,0),"\\%");names(spr) <- "SPR rate at $F_{MSY}$"
    b35    <- x$b35s ;                 names(b35)         <- paste0("$B_{35\\%}$")
    pbmsy  <- paste0(round(100*x$ssb1/x$bmsy,0),"\\%");    names(pbmsy)<- paste0("${B}_{", nextyr ,"}/B_{MSY}$")
    bzero  <- x$b0s ;                 names(bzero)        <- paste0("$B_0$")
    dynb0  <- x$dynb0s;      names(dynb0)                 <- "Est. $B_{2019} / B_{2019,no fishing}$"
    b_bmsy <- paste0(round(x$curssb/x$bmsy*100,0),"\\%");      names(b_bmsy) <- "$B_{2019} / B_{MSY}$"
    steep  <- round(x$steep,2);               names(steep) <- "Steepness"
    v      <- c(ssb, ssbcv, Bmsy, Bmsycv, pbmsy, bzero,b35, spr ,steep, dynb0,b_bmsy)
    df     <- cbind(df, v)
 }
df <- data.frame(rownames(df), df, row.names = NULL)
names(df) <- c("Component",mod_names[mod_scen])
tab <- xtable(df, caption = "Summary of model 16.1 results and the stock condition for EBS pollock. Biomass units are thousands of t.", label = "tab:res_summ", digits = 3)
print(tab, caption.placement = "top", include.rownames = FALSE, sanitize.text.function = function(x){x})

df <- NULL
mod_scen <- c(1,4,5)
for (ii in mod_scen) {
    x       <- modlst[[ii]]
    abcbiom <- paste0(x$ABC_biom1s,",000");         
    names(abcbiom)    <- paste0(nextyr," fishable biomass (GM)")
    msybiom           <- paste0(x$bmsyrs,",000");         
    names(msybiom)    <- paste0("Equilibrium fishable biomass at MSY")
    msyr        <- round(x$harmeanF,3);  
    names(msyr) <- ("MSY R (HM)")
    tier1abc        <- x$maxabc1s;  
    names(tier1abc) <- paste(nextyr,"Tier 1 ABC")
    fofl            <- x$arithmeanF;         
    names(fofl)     <- paste(nextyr,"Tier 1 $F_{OFL}$")
    ofl        <- x$ofl1s;         
    names(ofl) <- paste(nextyr,"Tier 1 OFL")
    fabc        <- round(0.85*x$harmeanF,3);  
    names(fabc) <- ("MSY R (HM)")
    recabc         <- x$abc1s;  
    names(recabc)  <- "Recommended ABC"
    v      <- c(abcbiom,msybiom,msyr,tier1abc,fofl,ofl,fabc,recabc)
    df     <- cbind(df, v)
}
df <- data.frame(rownames(df), df, row.names = NULL)
names(df) <- c("Component",mod_names[mod_scen])
tab <- xtable(df, caption = tabcap[28], label = paste0("tab:",tablab[28]), digits = 3,align=paste0("ll",strrep("r",length(mod_scen))) )
print(tab, caption.placement = "top", include.rownames = FALSE, sanitize.text.function = function(x){x})
```

